---
const { title = "Protocol Zero", active = "" } = Astro.props;
const current = String(active || "").toLowerCase();
const pages = [
  { name: "ABOUT", path: "/#about", key: "about" },
  { name: "ARTISTS", path: "/#artists", key: "artists" },
  { name: "CONTACTS", path: "/#contacts", key: "contacts" },
  { name: "RELEASES", path: "/releases", key: "releases" },
  { name: "SHOP", path: "/shop", key: "shop" },
];
---
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <link rel="preload" as="image" href="/images/logo.svg" />
    <link rel="stylesheet" href="/styles/global.css" />
    <link rel="stylesheet" href="/styles/header.css" />
  </head>
  <body>
    <header class="header">
      <div class="header-left">
        <a href="https://instagram.com" target="_blank" rel="noopener noreferrer" class="social-icon" aria-label="Instagram">
          <img src="/images/icons/instagram.svg" alt="Instagram" width="32" height="32" loading="eager" decoding="async" />
        </a>
      </div>
      <div class="header-center">
        <div class="menu-dropdown">
          <button class="menu-button" aria-label="Menu" aria-expanded="false">
            <a href="/" class="header-logo"><img src="/images/logo.svg" alt="Protocol Zero logo" width="80" height="80" loading="eager" decoding="async" /></a>
          </button>
          <nav class="dropdown-content">
            {pages.map(p => <a href={p.path} class={p.key === current ? 'active' : ''}>{p.name}</a>)}
          </nav>
        </div>
      </div>
      <div class="header-right">
        <a href="https://soundcloud.com" target="_blank" rel="noopener noreferrer" class="social-icon" aria-label="SoundCloud">
          <img src="/images/icons/soundcloud.svg" alt="SoundCloud" width="32" height="32" loading="eager" decoding="async" />
        </a>
      </div>
      <div class="header-current-page">{current ? (pages.find(p => p.key === current)?.name || '') : 'HOME'}</div>
    </header>
    <main><slot /></main>
    <script>
      const header = document.querySelector('.header');
      const menuBtn = document.querySelector('.menu-button');
      const dropdown = document.querySelector('.menu-dropdown');

      window.addEventListener('scroll', () => header?.classList.toggle('visible', window.scrollY > 100), { passive: true });

      if (menuBtn && dropdown) {
        menuBtn.addEventListener('click', e => { e.stopPropagation(); const open = dropdown.classList.toggle('open'); menuBtn.setAttribute('aria-expanded', String(open)); });
        dropdown.addEventListener('mouseenter', () => { dropdown.classList.add('open'); menuBtn.setAttribute('aria-expanded', 'true'); });
        dropdown.addEventListener('mouseleave', () => { dropdown.classList.remove('open'); menuBtn.setAttribute('aria-expanded', 'false'); });
        document.addEventListener('click', () => { dropdown.classList.remove('open'); menuBtn.setAttribute('aria-expanded', 'false'); });
      }
    </script>
  </body>
</html>
