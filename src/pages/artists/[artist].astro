---
import PageLayout from "../../layouts/PageLayout.astro";
import artists from "../../data/artists.json";

export async function getStaticPaths() {
  return artists.map(artist => ({ params: { artist: artist.slug }, props: { artist } }));
}

const { artist } = Astro.props;

const imgSrc = artist.image?.startsWith('/') ? artist.image : '/' + (artist.image || '');
const canonical = `https://protocolzero.online/artists/${artist.slug}`;

const brief = (artist.brief || "").toString().replace(/\|/g, "").trim();
const description =
  brief.length >= 20
    ? brief
    : `Artist profile: ${artist.name} â€” Protocol Zero drum & bass and neurofunk label`;

type LinkKey = 'instagram' | 'spotify' | 'soundcloud';
const socialLinks: { key: LinkKey; icon: string; alt: string }[] = [
  { key: 'instagram', icon: '/images/icons/instagram.svg', alt: 'Instagram' },
  { key: 'spotify', icon: '/images/icons/spotify.svg', alt: 'Spotify' },
  { key: 'soundcloud', icon: '/images/icons/soundcloud.svg', alt: 'SoundCloud' },
];
---

<PageLayout
  title={artist.name}
  active="artists"
  backLink="/artists"
  backText="Back to Artists"
  description={description}
  canonical={canonical}
  ogImage={`https://protocolzero.online${imgSrc}`}
>
  <div class="artist-detail-bg-blur" style={`background-image: url(${imgSrc})`}></div>
  <section class="artist-detail">
    <div class="artist-info">
      <div class="artist-image-wrapper">
        <img src={imgSrc} alt={artist.name} loading="eager" decoding="async" />
      </div>

      <h1>{artist.name}</h1>

      {Array.isArray(artist.flags) && artist.flags.length > 0 && (
        <div class="artist-flags">
          <span>Nationality:</span>
          <div class="flag-group">{artist.flags.map(flag => <img src={flag} alt="flag" class="flag-inline" />)}</div>
        </div>
      )}

      <div class="artist-description">
        {(artist.description || "").split("\n\n").map(p => <p>{p}</p>)}
      </div>

      {artist.links && (
        <div class="artist-icons">
          {socialLinks.map(({ key, icon, alt }) => artist.links[key] && (
            <a href={artist.links[key]} target="_blank" rel="noopener noreferrer">
              <img src={icon} alt={alt} />
            </a>
          ))}
        </div>
      )}

      {artist.trackEmbed && (
        <div
          class="artist-player artist-player-soundcloud soundcloud-frame"
          style={`--sc-bg: url(${imgSrc});`}
        >
          <div class="soundcloud-embed">
            <iframe
              width="100%"
              height="180"
              scrolling="no"
              frameborder="no"
              allow="autoplay"
              src={`https://w.soundcloud.com/player/?url=${encodeURIComponent(artist.trackEmbed)}&color=%23101416&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=false`}>
            </iframe>
          </div>
        </div>
      )}
    </div>
  </section>
</PageLayout>