---
import PageLayout from "../../layouts/PageLayout.astro";
import artists from "../../data/artists.json";

export async function getStaticPaths() {
  return artists.map(artist => ({ params: { artist: artist.slug }, props: { artist } }));
}

const { artist } = Astro.props;
const imgSrc = artist.image?.startsWith('/') ? artist.image : '/' + (artist.image || '');
type LinkKey = 'instagram' | 'spotify' | 'soundcloud';
const socialLinks: { key: LinkKey; icon: string; alt: string }[] = [
  { key: 'instagram', icon: '/images/icons/instagram.svg', alt: 'Instagram' },
  { key: 'spotify', icon: '/images/icons/spotify.svg', alt: 'Spotify' },
  { key: 'soundcloud', icon: '/images/icons/soundcloud.svg', alt: 'SoundCloud' },
];
---
<PageLayout title={artist.name} active="artists" backLink="/artists" backText="Back to Artists">
  <div class="artist-detail-bg-blur" style={`background-image: url(${imgSrc})`}></div>
  <section class="artist-detail">
    <img src={imgSrc} alt={artist.name} loading="eager" decoding="async" />
    <div class="artist-info">
      <h1>{artist.name}</h1>
      {Array.isArray(artist.flags) && artist.flags.length > 0 && (
        <div class="artist-flags">
          <span>Nationality:</span>
          <div class="flag-group">{artist.flags.map(flag => <img src={flag} alt="flag" class="flag-inline" />)}</div>
        </div>
      )}
      <div class="artist-description">
        {(artist.description || "").split("\n\n").map(p => <p>{p}</p>)}
      </div>
      {artist.links && (
        <div class="artist-icons">
          {socialLinks.map(({ key, icon, alt }) => artist.links[key] && (
            <a href={artist.links[key]} target="_blank" rel="noopener noreferrer"><img src={icon} alt={alt} /></a>
          ))}
        </div>
      )}
      {artist.trackEmbed && (
        <div class="artist-player">
          <iframe width="100%" height="180" style="border:0;overflow:hidden" allow="autoplay"
            src={`https://w.soundcloud.com/player/?url=${encodeURIComponent(artist.trackEmbed)}&visual=false&show_teaser=false&hide_related=true&color=%2357d6ff`}>
          </iframe>
        </div>
      )}
    </div>
  </section>
</PageLayout>
